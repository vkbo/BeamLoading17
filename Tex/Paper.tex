
%%
%%  Beam Loading Paper '17
%% ***************************
%%  Veronica K. Berglyd Olsen
%%

\documentclass[aps,prstab,reprint,amsmath,amssymb,groupedaddress]{revtex4-1}
\bibliographystyle{apsrev4-1}

\usepackage{hyperref}
\hypersetup{colorlinks=true, citecolor=blue, urlcolor=blue, linkcolor=blue}

\usepackage{graphicx}


% Custom Commands
%*****************

% Math
\newcommand{\unit}[1]{\,\mathrm{#1}}
\newcommand{\funit}[2]{\,\mathrm{#1}/\mathrm{#2}}
\newcommand{\mexp}[1]{\mathrm{e}{#1}}
\newcommand{\nexp}[1]{\times 10^{#1}}

% ******************************************************************************************************************** %
\begin{document}
% ******************************************************************************************************************** %

%Patric general comments
%  energy labels not consistent between figs 7, 9 and 8
%  labels for the fractional charge is too complicated on Figs 7,8,9. it needs to be explained in the caption and/or in
%  the text. "On the left axis we plot the fraction of that charge whose emittance remains .... "
%  Add scale for grey color on Fig. 2
%  Fig. 3 has a "v=c" and an arrow that are only on that figure ...
%  It is not clear to me what the conclusions/outcome of the last section are ....

%~ Eric's Comments
%~ Sec N: Beam loading [in this section we describe the interesting physics, based on a single parameters set]
%~ - describe proton beam wake structure [similar to that of a modulated proton beam] (simulation results to show:
%~   unloaded wake)
%~ - by varying the current of the electron beam, the electron beam may load the wake and the longitudinal field can be
%~   flatten and energy spread reduced [well known result, Tzoufras] 
%~ - the electron beam blows out the remaining plasma electrons. The transverse fields are dominated by the linear
%~   focusing fields originating from the ion background, leading to emittance preservation of the part of the electron
%~   beam inside the bubble [loading of a quasi-linear wake, and still get emittance preservation: this is new]
%~   (simulation results to show: loaded wake, with bubble - many different aspects of this, trans., long. field,
%~   electron densities etc. )
%~ - the acceleration and the transverse emittance stable on long timescales (simulation results to show: transverse and
%~   longitudinal phase spaces, space long simulation)
%~ - in this regime, emittance preservation is robustness to drive-witness offset [this is new] (simulation results to
%~   show: transverse and longitudinal phase spaces, long offset simulation)
%~ Sec N+1: Parameter optimization, or, parameter scaling [in this section we describe how to optimize the electron
%~ beam, and preferably some scalings]
%~ - how to select electron beam parameters:
%~ - longitudinal parameters bunch length and current (simulations results to show: overloaded/underloaded cases)
%~ - transverse parameters of electron emittance / matching [too large, outside bubble.  Do we see increased head
%~   erosion -> faster decay]?  (simulations results to show: evolution of high emittance vs low emittance cases)
%~ (- plasma density?)


%~ Patric's Comments
%~ - Self-modulation as a driver
%~ - SM does not reach blow out
%~ - SM does not preserve emittance and produces large energy spread and parameters may evolve along the accelerator,
%~   not desirable
%~ - Beam loading for narrow energy spread
%~ - Beam loading in linear regime (old papers from SLAC in the 80's, then Katsouleas for PWFA) and nonlinear regime
%~   (Tzoufras) well know
%~ - Propose "new regime" in the SM case, beam loading and blowout to get emittance preservation
%~ - Limitation as for PWFA driver, must use some of the W bunch to reach the blowout, it is kind of like the early SLAC
%~   experiments (84GeV) where the W-bunch is like the D-bunch in these experiments, but in a plasma prepared by the p+
%~   bunch and the SM
%~ - maybe also something about the fact that 200pC in a 60µm bunch corresponds to a 1kA current, much larger than the
%~   p+ bunch current, because of the fact that the wakefields are driven my multiple bunches?
%~ As for N+2, I am a firm supporter of on-axis injection ... and most of the issue with that has to do with the plasma
%~ ramp, otherwise it would be a non-issue (assuming of course that one can split the plasma in two sections). It is in
%~ itself a topic of research, so I think we can only state a few things ...


\title{Emittance preservation of an electron beam in a loaded quasi-linear plasma wakefield}

\author{Veronica K. Berglyd Olsen}
\email[]{v.k.b.olsen@cern.ch}

\author{Erik Adli}
\affiliation{University of Oslo, Oslo, Norway}

\author{Patric Muggli}
\affiliation{Max Planck Institute for Physics, Munich, Germany}
\affiliation{CERN, Geneva, Switzerland}

\date{\today}

\begin{abstract}
We investigate beam loading and emittance preservation for a high-charge electron beam being accelerated in quasi-linear
plasma wakefields driven by a short proton beam. The structure of the studied wakefields are similar to those of a long,
modulated proton beam, such as the AWAKE proton driver. We show that by properly choosing the electron beam parameters
and exploiting two well known effects, beam loading of the wakefield and full blow out of plasma electrons by the
accelerated beam, the electron beam can gain large amounts of energy with a narrow final energy spread (\%-level) and
without significant emittance growth.
\end{abstract}

\maketitle

% ******************************************************************************************************************** %
\section{Introduction}\label{S:I}
% interested from SMI/AWAKE
% requirements for AWAKE Run 2
% ******************************************************************************************************************** %

Beam driven plasma wakefield accelerators~\cite{chen:1985} have the potential to offer compact linear accelerators with
high energy gradients, and have been of interest for several decades. With a relativistic charged particle drive beam
travelling through a plasma, a strong wakefield is excited that can be loaded by a trailing witness beam. When the
witness beam optimally loads the wakefield, an increase in absolute energy spread can be kept small. The concept has
been demonstrated experimentally in the past using electron drive beams accelerating electron witness
beams~\cite{rosenzweig:1988, blumenfeld:2007, kallos:2008, litos:2014}. 

A major challenge with plasma wakefield accelerators is, however, to accelerate a beam while keeping both energy spread
and emittance growth small. In the well described linear regime, valid when the beam density $n_{b}$ is much smaller
than the plasma density $n_{0}$, a non-linear transverse focusing force causes emittance growth of the witness beam.
The beam also sees a transversely and longitudinally varying accelerating field causing a spread in energy after the
beam has been accelerated~\cite{katsouleas:1987}. In the non-linear regime, where $n_{b} > n_{0}$, a bubble is formed by
the transverse oscillations of the plasma electrons, gathering in a sheath around an evacuated area filled with only
ions. The ions, assumed stationary, form a uniform density ion channel creating a focusing force that varies linearly
with radius. This focusing force preserves emittance~\cite{rosenzweig:1991}.

In this paper we present simulation results showing how emittance preservation of a high charge density witness beam can
be ensured when accelerated by a proton drive beam producing quasi-linear wakefields~\cite{rosenzweig:2010}. By
quasi-linear wakefields we here mean wakefields with only partial blow out of the plasma electrons in the bubble.
The key idea is to have enough charge in the witness beam to at the same time load the wakefield to produce low relative
energy spread, and completely blow out the electrons left in the bubble after the beam to reach conditions that
preserves emittance. The results have importance for the preparation of AWAKE Run 2~\cite{adli:2016}, and possibly other
applications in the quasi-linear regime.


% ******************************************************************************************************************** %
%\subsection[\label{S:I:SMI}]{Self-modulation as a Driver}
%~ Patric's Comments
%~ - Self-modulation as a driver
%~ - SM does not reach blow out
%~ - SM does not preserve emittance and produces large energy spread and parameters may evolve along the accelerator,
%~   not desirable
% ******************************************************************************************************************** %

% 	EA comment: is this part relevant?  Feels out of place.  We repeat this physics below when discussing proton beam SMI.  
%A train of electron drive bunches with a separation $\lambda_{pe}$ and a length $l_{b} \ll \lambda_{pe}$, where the
%plasma wavelength $\lambda_{pe} = 2\pi c/\omega_{pe}$ and the plasma frequency $\omega_{pe} = (n_{0} e^{2} / m_{e}
%\epsilon_{0})^{1/2}$, produces a field $E_{z}$ that increases for each drive bunch~\cite{chen:1985}. A tailing witness
%beam loading the peak accelerating phase of this field will gain energy from the wakefield from all of the drive bunches
%when they are properly phased with respect to the wakefields. Acceleration of an electron witness beam driven by two
%electron drive beams has been demonstrated at Brookhaven National Laboratory~\cite{muggli:2011}.

% ******************************************************************************************************************** %
\subsection{AWAKE Run 2}\label{S:I:AWAKE}
% ******************************************************************************************************************** %

\begin{figure}[hbt]
    \includegraphics[width=0.99\linewidth,trim={1mm 2mm 1mm 2mm},clip]{figures/figAWAKE}
    \caption{\label{Fig:AWAKER2} A simplified illustration of the experimental setup for AWAKE Run 2. The SPS proton
        beam undergoes self-modulation in the first plasma section. The electron witness beam is injected into the
        accelerating structure, and undergoes acceleration in the second plasma
        section~\cite{berglyd_olsen:2015, adli:2016}}.
\end{figure}

The energy carried by electron drive beams used in previous plasma wakefield experiments have been on the order of
$100\unit{J}$ and the propagation length typically no more than $1\unit{m}$~\cite{blumenfeld:2007, caldwell:2009}.
For high-energy physics application a higher total beam energy is often desired. For instance, the energy of a
high-charge electron beam accelerated to $1\unit{TeV}$ with $1\nexp{10}$ electrons, similar to the beam that could be
produced by the International Linear Collider, is $1.6\unit{kJ}$. Using electron beams as drivers, a large number of
plasma stages is required to reach an energy of a $\unit{kJ}$ for the accelerated beam. However, staging plasma
accelerators without reducing the effective gradient and spoiling the beam quality is challenging
\cite{steinke:2016, lindstrom:2016}.

Proton beams available at CERN carry significantly more energy than available electron beams, $19\unit{kJ}$ for the SPS
beam~\cite{gschwendtner:2016}, allowing for much longer plasma wakefield accelerator stages. The SPS beam is orders of
magnitude longer than the plasma wavelengths needed for such applications, and it does not drive a strong
wake~\cite{gschwendtner:2016}. By letting the proton beam undergo self-modulation before injecting the witness beam into
the accelerating structure, stronger wakefields are excited. The self-modulation is produced by the transverse fields
generated by the beam acting upon itself, causing regions of the beam to rapidly defocus~\cite{kumar:2010}. The
modulation frequency is close to that of the plasma, and produces a train of short proton bunches along the beam axis
with a surrounding halo of defocused particles. This train of bunches resonantly drives wakefields to large amplitudes.

AWAKE at CERN is a proof of concept proton beam driven plasma wakefield accelerator experiment
\cite{awake_collaboration:2014}, currently in its first phase of operation. The experiment uses a $400\unit{GeV}$ proton
beam delivered by the SPS as its driver, and a single $10\unit{m}$ plasma stage with a nominal plasma density of
$7\nexp{14}\unit{cm}^{-3}$~\cite{gschwendtner:2016}. This plasma density corresponds to $\lambda_{pe} = 1.26\unit{mm}$
and is matched to the transverse size of the SPS proton beam such that $k_{pe}\sigma_{x,y,pb} = 1$~\cite{lu:2005}, where
$k_{pe} = 2\pi/\lambda_{pe}$ is the plasma wave number, $\lambda_{pe} = 2\pi c/\omega_{pe}$, and
$\omega_{pe} = \left(n_0e^2/m_e\epsilon_0\right)^{1/2}$ is the plasma electron angular frequency.

The aim of the first phase of the experiment is to demonstrate self-modulation of the proton beam. The aim of the second
phase, in 2018, is to sample the wakefield with a long electron beam $\simeq\lambda_{pe}$. The study presented here has
relevance for Run 2~\cite{adli:2016}, starting in 2021 after the LHC long shutdown 2, and aims to demonstrate
acceleration of a short electron beam, $\ll\lambda_{pe}$, to high energy and with a minimal increase in emittance and
absolute energy spread.

The plans for AWAKE Run 2 proposes to use two plasma sections, illustrated in Fig.~\ref{Fig:AWAKER2}. The first
section of about $4\unit{m}$ is the self-modulation stage where the proton beam undergoes self-modulation without the
electron beam present. The electron witness beam is then injected into the modulated proton beam before section two
where it undergoes acceleration. The self-modulated proton beam does not produce a fully non-linear wakefield, and
therefore not all plasma electrons are evacuated from the plasma bubble. The result is that the focusing force does not
increase linearly with radius and the accelerated beam emittance is not preserved. 

%   EA: Moved to "witness beam"
%The small size of the accelerating structure produced by the self-modulated beam also
%puts constraints on the size of the electron witness beam, and thus its charge and current, if at the same time we wish
%to prevent large energy spread. By matching the transverse size of the beam at a given emittance to the plasma density,
%we prevent large amplitude oscillations which may cause additional energy spread as well as emittance growth.

%    EA: I kept Patric's version, but moved it to the end of the introduction
%~ Eric's version:
%~ The key idea in this paper is that while the proton beam wake is not fully blown-out, and thus leading to non-linear
%~ focusing forces, the electron beam, if intense enough, may load the field and at the same time create its own ion
%~ bubble. As will be shown, exploiting these two well known effects, the electron beam can be accelerated for long
%~ distances without significant emittance growth.


% ******************************************************************************************************************** %
\section[\label{S:M}]{Method}
%- explain analogy of short-bunch, SMI case, by referring to earlier Veronica-papers
%- simulation setup PIC/quickpic OS
% ******************************************************************************************************************** %

The focus in this study is on the beam loading of the wakefields driven by the proton beam. Studies of self-modulated
proton beams show that the proton beam evolves as it propagates through a uniform plasma~\cite{lotov:2011}, but that
small variations in the plasma profile the modulation, and thus the wakefields, may be stabilised over long
distances~\cite{lotov:2011, lotov:2015, caldwell:2011}. To study the witness beam evolution in a stable wake,
independent of the dynamics of the self-modulation, we use a single, non-evolving proton bunch as driver. The proton
beam parameters are chosen so that key features of the wake \textendash the plasma electron density in the wake and the
longitudinal electric field \textendash are the same as in the wake of a self-modulated proton beam with AWAKE baseline
parameters~\cite{gschwendtner:2016}. Both the proton beam and the witness beam have Gaussian longitudinal charge
distribution and bi-Gaussian transverse charge distributions.

We have previously studied the beam loading in a proton beam wake using the full particle-in-cell (PIC) code
OSIRIS~\cite{fonseca:2002} with 2D cylindrical-symmetric simulations. The studies~\cite{berglyd_olsen:2015,
berglyd_olsen:2016} primarily looked at beam loading, energy gain and energy spread, as well as different approaches to
creating a stable drive beam structure based on previous self-modulation studies. In order to study the witness beam
emittance evolution we use the recently released open-source version of QuickPIC~\cite{huang:2006, an:2013}. QuickPIC is
a fully relativistic 3D quasi-static PIC code. It does not suffer from the numerical Cherenkov effect that full PIC
codes do~\cite{godfrey:1974,lehe:2013}, making it a well suited tool to study emittance preservation. All simulation
results in this paper were obtained using QuickPIC open-source~\cite{quickpic:web}.

%~ In order to evaluate the quality of the accelerated bunch it was also necessary to study emittance evolution. However,
%~ full PIC codes are vulnerable to numerical growth of emittance caused by the ``numerical Cherenkov effect''
%~ \cite{godfrey:1974}. This is a know issue with the Yee EMF solver which causes the phase velocity of electromagnetic
%~ fields to be lower than $c$ while the beam moves very close to $c$. The effect can be mitigated somewhat by replacing
%~ the Yee solver with a solver designed by Lehe \cite{lehe:2013}. Our simulations showed that this numerical effect is
%~ still prominent in the high density regions of our very compact electron bunch, making it difficult to distinguish
%~ emittance growth from the physics from that originating from numerical error.

\begin{figure}[hbt]
    \includegraphics[width=\linewidth,trim={2mm 0mm 2mm 0mm},clip]{figures/plasmaDenTWake}
    \caption{\label{Fig:PlasmaDenTWake} QuickPIC simulations of the initial time step for the single proton drive beam
        and witness beam setup. Plasma electron density is shown in grey with the drive beam (blue) and the witness beam
        (red) superimposed. The line plot indicates the transverse wakefield gradient $\textrm{d}W_{x}/\textrm{d}x$
        where $W_{x} = E_{x} - v_{b} B_{y}$, evaluated along the beam axis. Beams move to the left.}
\end{figure}

% ******************************************************************************************************************** %
\subsection{Drive Beam Parameters}\label{S:M:Setup}
%~ Patric's Comments
%~ - Self-modulation as a driver
%~ - SM does not reach blow out
%~ - SM does not preserve emittance and produces large energy spread and parameters may evolve along the accelerator,
%~   not desirable
% ******************************************************************************************************************** %

%~ In these simulations we use a single proton drive beam that sets up a wakefield comparable to that which we expect to
%~ see from the self-modulated SPS beam in the second plasma cell of AWAKE Run 2 (Figure \ref{Fig:AWAKER2}).
%PM The baseline AWAKE drive beam current is insufficient to reach the non-linear regime and produce a plasma bubble.

The modulation process used in AWAKE does not reach the fully non-linear regime and thus does not produce a bubble void
of plasma electrons. When the SPS beam, containing $3\nexp{11}$ protons~\cite{gschwendtner:2016}, enters the second
plasma section (Fig.~\ref{Fig:AWAKER2}), the peak electric field is expected to be about $500\funit{MV}{m}$. The
plasma electron density is only depleted to around $65\%$ of nominal plasma density at the point where we inject the
electron beam~\cite{awake_collaboration:2016}. The plasma electron density depletion and the peak field is replicated
using a single bunch with $1.46\nexp{10}$ protons ($2.34\unit{nC}$), a length $\sigma_{z} = 40\unit{\mu m}$
($7\unit{kA}$), and a transverse size $\sigma_{x,y,pb} = 200\unit{\mu m}$. The peak density at $0.83\cdot n_{0}$ results
in a quasi-linear wake. To avoid transverse evolution of the proton driver, emulating the stable propagation of the
self-modulated proton beam~\cite{lotov:2011, lotov:2015, caldwell:2011}, we freeze the transverse evolution of the
equivalent proton bunch by increasing the particles mass by six orders of magnitude.

% ******************************************************************************************************************** %
\subsection{Witness Beam Parameters}\label{S:M:Setup}
% ******************************************************************************************************************** %

In order to prevent large amplitude oscillations of the witness beam particles, which may cause additional energy spread
as well as emittance growth, we consider a witness beam matched to the plasma density. The matched beam transverse
size~\cite{esarey:1996} is:
\begin{equation}
    \sigma_{x,y,eb}=\left(\frac{2c^{2}\epsilon_{\mathrm{N}}^{2}m_{e}\varepsilon_{0}}{n_{pe}e^{2}\gamma}\right)^{1/4}
    \label{EQ:Matched}
\end{equation}

We assume an initial normalized emittance of $\epsilon_{\mathrm{N}} = 2\unit{\mu m}$. This emittance is possible to
produce with a standard RF-injector, while at the same time yielding a sufficiently narrow beam.
% EA: comment, perhaps put a ref here [***ref]. 

Beam loading of a short witness beam is sensitive to its position relative to the electric field~\cite{tzoufras:2009}
as well as to its de-phasing with respect to the wakefields at low energy. To eliminate de-phasing of the witness beam,
the initial beam energy is set such that $\gamma_{eb} = \gamma_{pb} = 426.3$, giving an energy of $217\unit{MeV}$. A
lower initial energy is likely to be sufficient for AWAKE Run 2 injection.
% EA: we have studied this to some extent, but unfortunately we do not have a good refence for the last statement,
%     no details in \cite{berglyd_olsen:2015}.

Equation~(\ref{EQ:Matched}) yields a transverse size $\sigma_{x,y,eb}$ of $5.25\unit{\mu m}$, which is narrow compared
to the drive beam $\sigma_{x,y,pb} = 200\unit{\mu m}$. The bunch length was set to $\sigma_{z} = 60\unit{\mu m}$ based
on earlier beam loading studies~\cite{berglyd_olsen:2016}. The charge is adjusted to $100\unit{pC}$ for optimal beam
loading, as discussed in the next section. We refer to the defined drive beam and witness beam parameter set as the
\emph{base case}. Figure~\ref{Fig:PlasmaDenTWake} shows the two beams from a QuickPIC simulation of the initial time
step, for the base case parameters; the proton beam in blue, the trailing electron beam in red, and the plasma electron
density in grey. 

%   EA: the discussing of charge could better be discussed in the "beam loading chapter" - the information has been moved to there
% the charge required to load the field is 
% density of the electron beam reaches that of the plasma density for a bunch charge of a few $\unit{pC}$.   
% but reaches optimal beam loading at around $100-200\unit{pC}$. 
%The implication here being that the witness beam produces its own non-linear
%wakefield already at the head of the beam. The majority of the electrons within it will therefore see a linear focusing
%force preventing the bulk of the beam from undergoing emittance growth.


% ******************************************************************************************************************** %
\subsection{Simulation parameters}\label{SIM}
% ******************************************************************************************************************** %

The relatively small size of the witness beam puts constraints on the transverse grid cell size and number in the
simulations. We need a small size to resolve the narrow electron beam, and a large number of grid cells to resolve the
much wider proton beam and its wakefields. We use a transverse grid cell size of $1.17\unit{\mu m}$, and of
$2.34\unit{\mu m}$ for the longitudinal grid cells for the simulations presented in section~\ref{S:BL}. The witness beam
was simulated with $16.8\nexp{6}$ non-weighted particles, the drive beam with $2.1\nexp{6}$ non-weighted particles, and
the plasma electrons with $1024 \times 1024$ weighted particles per transverse slice.

\begin{figure}[hbt]
    \includegraphics[width=\linewidth,trim={2mm 0mm 2mm 0mm},clip]{figures/beamLoading}
    \caption{\label{Fig:BeamLoading} Top plot: Unloaded longitudinal electric field with no witness beam
        (dashed blue line) and loaded field (whole blue line) along the beam axis. The beam density along the axis for
        both beams are shown in red.
        Bottom plot: Plasma densities along the beam axis for a drive beam with no witness beam (dashed green line),
        witness beam with no drive beam (dash-dotted green line), and both beams present (whole green line).
        $\xi = z - tc$ is the position in the simulation box, moving towards the left. The plots show the initial time
        step.}
\end{figure}

\begin{figure}[hbt]
    \includegraphics[width=\linewidth,trim={2mm 0mm 2mm 0mm},clip]{figures/beamPhaseSpace}
    \caption{\label{Fig:BeamPS} Longitudinal phase space charge distribution of a $100\unit{pC}$, $60\unit{\mu m}$ long
        witness beam after $4\unit{m}$ of plasma. The mean momentum is $1.67\unit{GeV/c}$ with an RMS energy spread
        of $87\unit{MeV/c}$ ($5.2\%$) for the full beam.}
\end{figure}

\begin{figure*}[hbt]
    \includegraphics[width=0.495\linewidth,trim={2mm 0mm 2mm 0mm},clip]{figures/beamEmittance}
    \includegraphics[width=0.495\linewidth,trim={2mm 0mm 2mm 0mm},clip]{figures/beamEmittanceOffset}
    \caption{\label{Fig:BeamEmitt} Beam density in blue along the beam axis for an on-axis beam with respect to the
        drive beam axis (left), and an offset beam (right) with an offset of one $\sigma_{x,eb} = 5.24\unit{\mu m}$ in
        the x-plane \textendash at four different positions $z$ in the plasma stage. The red lines show a moving window
        calculation of transverse normalised emittance. The moving window calculation uses longitudinal slices of
        $l = 4\cdot\Delta\xi = 9.38\unit{\mu m}$ with a step of $\Delta\xi$. Only slices with more than $100$ macro
        particles have been included. The plasma density profile is included in green, and scaled up by a factor of
        $100$ to be visible. These simulations were run with an LHC energy drive beam of $7\unit{TeV}$}
\end{figure*}

\begin{figure*}[hbt]
    \includegraphics[width=\linewidth,trim={0mm 0mm 0mm 0mm},clip]{figures/beamFilamentationAll}
    \caption{\label{Fig:BeamFilament} Plots \textbf{a} to \textbf{f} show the transverse phase space of the offset
        electron beam at different plasma positions. Plot \textbf{g} shows the macro particle mean position, and plot
        \textbf{h} their RMS spread. Plots \textbf{a}, \textbf{b} and \textbf{c}, as well as the blue lines in plots
        \textbf{g} and \textbf{h} represent particles not in the ion column (see Fig.~\ref{Fig:BeamEmitt}), with
        position $1.40\unit{\mu m} < \xi < 1.42\unit{\mu m}$. Plots \textbf{d}, \textbf{e} and \textbf{f}, and the red
        lines in plots \textbf{g} and \textbf{h} represent particles in the ion column with position
        $1.55\unit{\mu m} < \xi < 1.57\unit{\mu m}$.}
\end{figure*}

% ******************************************************************************************************************** %
\section{Beam Loading}\label{S:BL}
%~ Eric's Comments
%~ Sec N: Beam loading [in this section we describe the interesting physics, based on a single parameters set]
%~ - describe proton beam wake structure [similar to that of a modulated proton beam] (simulation results to show:
%~   unloaded wake)
%~ - by varying the current of the electron beam, the electron beam may load the wake and the longitudinal field can be
%~   flatten and energy spread reduced [well known result, Tzoufras]
%~ - the electron beam blows out the remaining plasma electrons. The transverse fields are dominated by the linear
%~   focusing fields originating from the ion background, leading to emittance preservation of the part of the electron
%~   beam inside the bubble [loading of a quasi-linear wake, and still get emittance preservation: this is new]
%~   (simulation results to show: loaded wake, with bubble - many different aspects of this, trans., long. field,
%~   electron densities etc. )
%~ - the acceleration and the transverse emittance stable on long timescales (simulation results to show: transverse and
%~   longitudinal phase spaces, space long simulation)
%~ - in this regime, emittance preservation is robustness to drive-witness offset [this is new] (simulation results to
%~   show: transverse and longitudinal phase spaces, long offset simulation)
%~
%~ Patric's Comments
%~ - Beam loading for narrow energy spread
%~ - Beam loading in linear regime (old papers from SLAC in the 80's, then Katsouleas for PWFA) and nonlinear regime
%~   (Tzoufras) well know
%~ - Propose "new regime" in the SM case, beam loading and blowout to get emittance preservation
%~ - Limitation as for PWFA driver, must use some of the W bunch to reach the blowout, it is kind of like the early SLAC
%~   experiments (84GeV) where the W-bunch is like the D-bunch in these experiments, but in a plasma prepared by the p+
%~   bunch and the SM
%~ - maybe also something about the fact that 200pC in a 60µm bunch corresponds to a 1kA current, much larger than the
%~   p+ bunch current, because of the fact that the wakefields are driven my multiple bunches?
% ******************************************************************************************************************** %

%  EA: the below has already been clearly spelled out in methods
%The single drive beam setup is designed to produce similar initial conditions for the witness beam as the self-modulated
%case. However, since the drive beam is prevented from significant transverse evolution, we are presented with an
%idealised case where the electron witness beam sees consistent wakefields throughout the plasma stage. 

Figure~\ref{Fig:BeamLoading} shows the results of QuickPIC simulations of the initial time step for the base case
parameters. The $E_{z}$-field generated by the proton drive beam is seen as the blue line, shown with and without the
electron beam present. With a proton beam density $n_{pb} \simeq n_{0}$, the wakefields are in the quasi-linear
regime~\cite{rosenzweig:2010}. The dashed green line in the lower part of Fig.~\ref{Fig:BeamLoading} shows that the
on-axis plasma density has a depletion to $67\%$, close to what we see in full scale reference simulations for AWAKE
Run 2~\cite{awake_collaboration:2016}.

%~ The witness beam generates its own wakefield, which in the accelerating phase partially cancels out the $E_{z}$ field
%~ generated by the drive beam. For a finite length beam this causes the particles in the tail of the witness beam to be
%~ accelerated less than those at the front resulting in higher energy spread in exchange for higher energy transfer
%~ \cite{van_der_meer:1985}. A beam profile $\rho_{b}(\xi)$ that perfectly flattens the
%~ accelerating field within the witness beam will reduces energy spread to zero. The ideal shape is triangular or
%~ trapezoidal with the peak density in the direction of the beam velocity \cite{katsouleas:1987, tzoufras:2009}.

The witness beam generates its own wakefield which loads the $E_{z}$-field generated by the drive beam. With an ideally
shaped electron beam charge profile it is possible to optimally load the field in such a way that the accelerating field
is constant along the beam~\cite{katsouleas:1987, tzoufras:2009}. Gaussian beams, as assumed in these studies, cannot
completely flatten the electric field in the tails of the charge distribution, and our base case beam therefore has a
tail in energy both at the front and the back of the beam, as illustrated in Fig.~\ref{Fig:BeamPS}. The bulk of the
beam, however, sees a relatively flat field.
% EA: I rewrote this to the sentence after the comments
%we can acceleratoreHowever, with such a narrow beam when matched beam to the plasma density (equation
%\ref{EQ:MatchedB}), we are limited on how much total charge we can accelerate without reaching charge densities that
%will overload the field.
%  EA: shall we say the below?  The sentence asks for more detailed studies of the dependence of the loading of the transverse fields.
%The amounts of charge required to load the field depends both on the witness bunch length as well as the transverse size. 

The initial electron beam density is $n_{eb} \approx 35\cdot n_{0}$. This means that the witness beam's own wakefield
is in the fully non-linear regime, where the space charge force is sufficient to blow out all plasma electrons,
resulting in the formation of an ion column (see Fig.~\ref{Fig:BeamLoading}, bottom). This ion column, as is well
known~\cite{rosenzweig:1991}, provides a linear focusing force on the part the electron beam within the column, and
therefore prevents emittance growth for this part of the beam. This effect is shown for our base case in
Fig.~\ref{Fig:PlasmaDenTWake}. The focusing field has a gradient of $20\unit{kT/m}$ near the beam axis, corresponding to
the matched field gradient.

%~ Due to the high charge density resulting from a very narrow beam, the witness beam's own wakefield reaches the full
%~ non-linear regime with $n_{eb} \approx 35\times n_{0}$. This second wakefield is driven by the beam's own front. The
%~ space charge rapidly becomes high enough to start expel plasma electrons from the beam axis and form the characteristic
%~ electrons sheet that defines the blowout regime. As a result the plasma region reaches full depletion close to the peak
%~ of the electron beam, which in turn generates strong focusing fields, with gradients of $20\unit{kT/m}$ near the beam
%~ axis (see figure \ref{Fig:PlasmaDenTWake}).

%~ The witness beam's self-generated bubble prevents the tailing end of the beam to see any significant emittance growth.
% EA: I cut the line below, we are still discussing the base case
%For the majority of the cases we studied, that maintained a stable accelerating structure, 
 %PMDue to the ion column focusing, 

\begin{figure*}[hbt]
    \begin{minipage}[t]{.48\textwidth}
        \includegraphics[width=\linewidth,trim={2mm 0mm 2mm 0mm},clip]{figures/beamQuality}
        \caption{\label{Fig:BeamQ} Ratio of witness beam charge with emittance preserved, $\widetilde{Q}/Q$ (blue
            symbols, lines), as a function of initial beam charge, and relative energy spread of the accepted charge
            (red symbols, dashed lines), after $4\unit{m}$ of plasma and with an initial emittance
            $\epsilon_{\mathrm{N},0}=2\unit{\mu m}$. These are shown for four different $\sigma_{z}$ from
            $40\unit{\mu m}$ to $100\unit{\mu m}$. The detailed studies presented in beam loading section correspond to
            the square marked lines at $100\unit{pC}$.}
    \end{minipage}\hfill
    \begin{minipage}[t]{.48\textwidth}
        \includegraphics[width=\linewidth,trim={2mm 0mm 2mm 0mm},clip]{figures/beamQualityAbs}
        \caption{\label{Fig:BeamQAbs} Witness beam charge with emittance preserved, $\widetilde{Q}$ (blue symbols,
            lines), as a function of initial beam charge, and final energy (red symbols, dashed lines), after
            $4\unit{m}$ of plasma and with an initial emittance $\epsilon_{\mathrm{N},0}=2\unit{\mu m}$.}
    \end{minipage}
\end{figure*}

Figure~\ref{Fig:BeamEmitt} shows the slice emittance along the beam for the base case, sampled after propagating through
$0$, $4$, $40$ and $100\unit{m}$ of plasma. We define emittance of a slice as preserved if the growth is less than
$5\%$, and $\widetilde{Q}$ as the sum charge of the slices for which the emittance is preserved. Simulation results show
that $\widetilde{Q}/Q = 73\%$ of the electron beam longitudinal slices retain their initial emittance after the
propagation in the plasma. The total (projected) emittance of these slices combined is also preserved. Emittance growth
mainly occurs in the first few metres, and no significant emittance growth is observed after this for propagation
lengths up to $100\unit{m}$. The head of the beam does not benefit from the full ion column focusing, but since the
proton beam creates a quasi-linear wake, the emittance of the head of the beam still stabilises after some time. For the
$100\unit{m}$ simulation, the drive beam energy was increased to $7\unit{TeV}$ (LHC energy) to prevent de-phasing, as
de-phasing starts to become a significant effect for the SPS beam of $400\unit{GeV}$ after about $50\unit{m}$.

%~ Our configuration also shows some robustness to small electron beam transverse offsets as the bubble generated by the
%~ witness beam wakefield follows the beam itself.
So far we have considered a witness beam injected on the axis of the proton beam. We now briefly examine the case of
injection of a witness beam with an offset with respect to the proton beam axis. Since the witness beam creates its own
plasma bubble, the emittance of the part of the beam inside the bubble is not affected by small transverse offsets of
the witness beam with respect to the proton beam axis. This is illustrated in Fig.~\ref{Fig:BeamEmitt}, right, for an
electron beam offset of one $\sigma_{x,eb}$. Emittance preservation for small offsets is an added benefit of this
accelerating regime, and may ease transverse injection tolerances. The head of the beam experiences a larger initial
emittance growth than for the on-axis case (compare Fig.~\ref{Fig:BeamEmitt}, left, to Fig.~\ref{Fig:BeamEmitt}, right).
However, also for the head of the beam the emittance growth ends after the first few metres.
Figure~\ref{Fig:BeamFilament}a-c show the phase space of the head of the electron beam after $0$, $1.0$ and
$2.5\unit{m}$, while Fig.~\ref{Fig:BeamFilament}d-f show the phase space of the trailing part of the beam. The
centroid oscillations of the head and the trailing part are shown in Fig.~\ref{Fig:BeamFilament}g. This effect of a
transverse offset is greater for larger offsets as the beam oscillates around the axis of the drive beam wakefield.

The transverse beam size within the bubble, where normalised emittance is preserved, follows the evolution given by
Eq.~\ref{EQ:Matched}; that is, evolves to stay matched. The on-axis density of the electron beam, as a result,
increases as its gamma factor increases and its transverse size decreases. This effect can be seen in Fig.
\ref{Fig:BeamFilament}h. This has the potential to cause overloading of the field. However, for the base case no
significant overloading is observed.  

% ******************************************************************************************************************** %
\section{Parameter Optimisation}\label{S:PO}
%~ Sec N+1: Parameter optimization, or, parameter scaling [in this section we describe how to optimize the electron
%~ beam, and preferably some scalings]
%~ - how to select electron beam parameters:
%~ - longitudinal parameters bunch length and current (simulations results to show: overloaded/underloaded cases)
%~ - transverse parameters of electron emittance / matching [too large, outside bubble.  Do we see increased head
%~   erosion -> faster decay]?  (simulations results to show: evolution of high emittance vs low emittance cases)
%~ (- plasma density?)
% ******************************************************************************************************************** %

The beam loading and blow out properties of the electron beam depend on a large number of parameters, including
longitudinal profile, transverse profile, as well as relative phasing of the proton and the electron beams. We present a
limited parameter study aimed at guiding beam parameter choices for AWAKE Run 2. For an electron beam to be externally
injected in AWAKE Run 2 (see Fig.~\ref{Fig:AWAKER2}) it is desired to maximise the energy gain, minimise the energy
spread, maximise the charge to be accelerated, and minimise the emittance growth~\cite{adli:2016}. In addition, the
beam length should be such that it is possible to generate and transport the beam using a compact electron
injector~\cite{adli:2016}. We investigate the interdependence of these parameters in simulation by varying the electron
beam length, its charge, and initial emittance. The results are quantified in terms of how much of the beam retains its
initial emittance. For these parameter scans we used a transverse grid cell size of $2.34\unit{\mu m}$, and let the
beams propagate through $4\unit{m}$ of plasma.

\begin{figure*}[hbt]
    \begin{minipage}[t]{.48\textwidth}
        \includegraphics[width=\linewidth,trim={2mm 0mm 2mm 0mm},clip]{figures/beamQualityEmittance}
        \caption{\label{Fig:BeamQEmit} Ratio of witness beam charge with emittance preserved, $\widetilde{Q}/Q$ (blue
            symbols, line), as a function of beam initial emittance (right), with relative energy spread of the accepted
            charge (red symbols, dashed line), after $4\unit{m}$ of plasma.}
    \end{minipage}\hfill
    \begin{minipage}[t]{.48\textwidth}
        \includegraphics[width=\linewidth,trim={2mm 0mm 2mm 0mm},clip]{figures/beamQualityOffset}
        \caption{\label{Fig:BeamQOffset} Ratio of witness beam charge with emittance preserved, $\widetilde{Q}/Q$ (blue
            symbols, line), as a function of beam offset, with relative energy spread of the accepted charge (red
            symbols, dashed line), after $4\unit{m}$ of plasma.}
    \end{minipage}
\end{figure*}

Figure~\ref{Fig:BeamQ} shows the dependence of charge and energy spread on witness beam length and incoming charge. An
initial beam emittance of $2\unit{\mu m}$ was used. Therefore, we define the fractional charge $\widetilde{Q}$ as the
charge whose emittance remains smaller than $2.1\unit{\mu m}$. The beam charges range from $10\unit{pC}$ to
$300\unit{pC}$, and $\sigma_{z}$ ranges from $40\unit{\mu m}$ to $100\unit{\mu m}$. As can be seen from Fig.
\ref{Fig:BeamQ} (red curves), both the $40\unit{\mu m}$ and the $60\unit{\mu m}$ beams have a well defined minimum
energy spread with an initial beam charge $\approx 50\unit{pC}$ and $\approx 100\unit{pC}$, respectively. Lower beam
charges tend to underload the electric field, while higher beam charges tend to overload it. It is also clear that
longer beams with respect to the accelerating phase of the field, $\approx\lambda_{pe}/4$, do not optimally load the
wake, thus producing a larger spread in energy. The blue curves show the fraction of charge whose initial emittance is
preserved (the slice emittance for the base case is shown in Fig.~\ref{Fig:BeamEmitt}). As the witness beam charge
increases, the fraction of slices with preserved emittance increases \textendash as expected from an earlier onset of
the bubble formation \textendash and also increases in the bubble size~\cite{lu:2006-1, lu:2006}. We note here that
operation with $100\unit{pC}$ leads to a significantly larger charge (factor $\sim 4$) with emittance preserved, at the
expense of an increase of relative energy spread by a factor of two.

Figure~\ref{Fig:BeamQAbs} shows the dependence of mean energy gain on beam length and beam charge (red curves). The blue
curves show the amount of charge in the longitudinal slices where the emittance has been preserved, as a function of
beam length and beam charge.

Figure~\ref{Fig:BeamQEmit} shows how the growth in emittance and energy spread varies with initial electron beam
emittance. In these simulations we adjusted the witness beam radius to maintain the matching condition at each
emittance. The smaller the initial emittance is, the better the emittance is preserved. There are two effects that lead
to emittance growth for high initial emittance beams: the transverse beam size may increase beyond the size of the
bubble, and the beam density may be reduced so much that the plasma electrons are no longer fully evacuated from the
bubble. Emittance values higher than a few micrometres lead to a significant increase in both emittance and energy
spread. 

Our base case showed some robustness to a small offset from the proton beam axis on the order of one $\sigma_{x}$, but
with a cost in the fraction of the beam which retains its initial emittance. Figure~\ref{Fig:BeamQOffset} shows the
correlation between this ratio for a range of offsets up to $3.2\cdot\sigma_{x}$. The effect on the head of the beam,
shown in Figs.~\ref{Fig:BeamEmitt} and~\ref{Fig:BeamFilament}, increases with larger offsets causing the section of the
beam being defocused to extend backwards to the point where the witness beam wakefields are no longer in the blow-out
regime. At around $3\cdot\sigma_{x}$ emittance is no longer preserved at all.

% EA: slight rewrite to argue what we want with this section
The optimal working point will depend on the application and must be studied for each case and is, as illustrated in
this section, a trade off between beam length, beam charge and emittance preservation, as well as other parameters
like the plasma density.   

% ******************************************************************************************************************** %
\section{Conclusion}\label{S:C}
% ******************************************************************************************************************** %

%~ We have studied a new plasma wakefield acceleration regime; acceleration of a strongly loaded electron beam in a
%~ quasi-linear proton driven wake. When optimally loaded an electron witness beam has sufficient charge to create a
%~ strong blow out forming a %n ion 
%~ bubble trailing the witness beam.  The focusing forces from the ions ensures emittance preservation for large parts of
%~ the %PM 
%~ witness beam. %PM, also when the electron beam has some offset with respect to the proton driver.
%~ Simulations show that the emittance of a large fraction of the electron beam is preserved even when it enters the plasma
%~ with and offset with respect to the proton bunch axis.

%~ Using AWAKE parameters these result indicates that emittance preservation for an electron beam injected on-axis into a
%~ plasma stage, and properly optimized, may be feasible. Parameter studies indicate that up to a few $100\unit{pC}$ might
%~ be accelerated, for bunches of length $40-60\unit{\mu m}$. Such electron bunches may be generated by an injector based
%~ on a standard RF gun [S. Doebert, private communication].

%~ This study assumes a simplified case with respect to a self-modulated proton beam, where the wake is driven by a single,
%~ short proton bunch, and investigates an ideal, uniform plasma profile.  To fully investigate optimal AWAKE injection,
%~ further study should be performed including simulations of realistic plasma profiles combined with a self-modulated
%~ proton beam.  
% EA: we could also say "is underway" and cite Lotov et co?
% PM: NOT SURE WHAT PLASMA PROFILE WEA RE TALKING ABOUT ... I would suggest -
%     EA patric's verson of conclusions are OK with me

We have devised a method to accelerate an electron witness beam to high energy with a low relative energy spread while
maintaining its incoming emittance in wakefields such that the accelerating structure is not void of plasma electrons.
This is the case for the AWAKE experiment in which the wakefields are driven by a train of proton bunches produce by
self-modulation of a long proton beam. This method is in principle applicable to all experiments operating in the
quasi-linear regime. Low relative energy spread and emittance preservation are achieved by choosing the electron beam
parameters to load the wakefields and evacuate the remaining plasma electrons from the accelerating structure.
 
Parameter studies indicate that for up to a few $100\unit{pC}$, about $70\%$ of the incoming beam charge is accelerated
for beam of lengths of $40-60\unit{\mu m}$. Such electron beams may be generated by an injector based on a standard
RF photo-emission gun~\cite{doebert:corr}.

In order to use manageable computer time for simulations, this study assumes a simplified case with respect to a
self-modulated proton beam, where the wake is driven by a single, short proton bunch producing similar wakefields.
However, the wakefields driven by a train of bunches evolve with the ramp of a real plasma and when entering the plasma.
Therefore, to be fully applicable to an experiment such as AWAKE, the study will have to be redone with more realistic
parameters. However, using loading of the wakefields and the pure plasma ion column fields to produce an accelerated
beam with low relative energy spread and emittance remains applicable.

\section{Acknowledgements}\label{Ack}
% ******************************************************************************************************************** %

% EA: I think owned also by IST.  I will check with Weiming and Warren
The simulations for this study have been performed using the open source version of QuickPIC released in early 2017
and owned by UCLA.

These numerical simulations have been made possible through access to the \emph{Abel} computing cluster in Oslo, Norway.
Abel is maintained by UNINETT Sigma2 AS and financed by the Research Council of Norway, the University of Bergen, the
University of Oslo, the University of Troms{\o} and the Norwegian University of Science and Technology. Project code:
nn9303k. Some of the simulations were also run on the student-maintained computing cluster \emph{Smaug} at the
University of Oslo, Department of Physics.

We gratefully acknowledge helpful discussions with Jorge Vieira from IST, Lisbon.
\vfill

% ******************************************************************************************************************** %
\bibliography{Bibliography,Additional}
\end{document}
% ******************************************************************************************************************** %
